<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agriculture Chatbot - Groq</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Poppins', sans-serif;
    }

    body {
      position: relative;
      overflow: hidden;
      min-height: 100vh;
    }

    .nature-bg {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: -10;
    }

    .cloud {
      animation: floatClouds 60s linear infinite;
    }

    @keyframes floatClouds {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .sun {
      animation: pulse 6s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      100% { transform: scale(1.05); }
    }
  </style>
</head>
<body class="text-gray-800 font-sans flex items-center justify-center p-6">

  <!-- ðŸŒ¿ Nature-Themed SVG Background -->
  <svg class="nature-bg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 720" preserveAspectRatio="xMidYMid slice">
    <rect width="1440" height="720" fill="#d1fae5" />
    <circle class="sun" cx="1200" cy="120" r="60" fill="#facc15" />
    <g class="cloud" fill="#ffffff" opacity="0.6">
      <circle cx="100" cy="100" r="30"/>
      <circle cx="140" cy="100" r="40"/>
      <circle cx="180" cy="100" r="30"/>
    </g>
    <g class="cloud" fill="#ffffff" opacity="0.6" transform="translate(600, 50)">
      <circle cx="100" cy="100" r="30"/>
      <circle cx="140" cy="100" r="40"/>
      <circle cx="180" cy="100" r="30"/>
    </g>
    <path d="M0 600 Q 360 500 720 600 T 1440 600 V720 H0 Z" fill="#a7f3d0"/>
    <path d="M0 650 Q 360 550 720 650 T 1440 650 V720 H0 Z" fill="#6ee7b7"/>
    <!-- Tree -->
    <g transform="translate(150, 500)">
      <rect x="20" y="30" width="10" height="40" fill="#654321"/>
      <circle cx="25" cy="20" r="25" fill="#22c55e"/>
    </g>
    <g transform="translate(1000, 520)">
      <rect x="20" y="30" width="10" height="40" fill="#654321"/>
      <circle cx="25" cy="20" r="25" fill="#16a34a"/>
    </g>
  </svg>

  <!-- ðŸŒ¾ Chat UI Box -->
  <div class="max-w-xl w-full bg-white bg-opacity-90 backdrop-blur-md rounded-2xl shadow-2xl p-6 border border-green-200 z-10">
    <h1 class="text-3xl font-bold mb-4 text-green-700 text-center">ðŸŒ± AgriHelper Bot</h1>
    <p class="text-center text-gray-600 mb-6">Type your farming question or upload voice to get help!</p>

    <!-- Text Input Form -->
    <form id="textForm" class="flex items-center gap-3 mb-6">
      <input
        type="text"
        name="text"
        id="textInput"
        class="flex-1 border border-green-300 rounded-full px-5 py-3 focus:outline-none focus:ring-2 focus:ring-green-500 bg-green-50 shadow-inner"
        placeholder="Ask something about crops, weather, pests..."
        autocomplete="off"
      />
      <button
        type="submit"
        class="bg-green-600 text-white px-5 py-2 rounded-full hover:bg-green-700 transition font-semibold"
      >
        Ask
      </button>
    </form>

    <!-- Audio Upload Form -->
    <form id="audioForm" enctype="multipart/form-data" class="flex items-center gap-3 mb-6">
      <input
        type="file"
        name="audio"
        id="audioInput"
        accept="audio/*"
        class="flex-1 text-sm border border-green-300 rounded-full bg-green-50 px-4 py-2 shadow-inner"
      />
      <button
        type="submit"
        class="bg-blue-600 text-white px-5 py-2 rounded-full hover:bg-blue-700 transition font-semibold"
      >
        Upload
      </button>
    </form>

    <!-- Result Box -->
    <div id="result" class="bg-green-50 border border-green-200 p-4 rounded-xl shadow-inner hidden transition-all duration-500" role="region" aria-live="polite">
      <h2 class="font-semibold text-lg text-green-800 mb-2">ðŸ’¡ Answer:</h2>
      <p id="responseText" class="text-gray-700 mb-3 whitespace-pre-wrap leading-relaxed"></p>
      <audio id="audioPlayer" controls class="w-full rounded-lg hidden shadow-md"></audio>
    </div>
  </div>

  <script>
    // Text form submit handler
    document.getElementById('textForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = document.getElementById('textInput').value.trim();
      if (!text) return;

      const formData = new FormData();
      formData.append('text', text);

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();
        showResponse(data.text, data.voice);
      } catch (err) {
        alert('Error communicating with server.');
      }
    });

    // Audio upload submit handler
    document.getElementById('audioForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fileInput = document.getElementById('audioInput');
      if (!fileInput.files.length) return alert('Please select an audio file.');

      const formData = new FormData();
      formData.append('audio', fileInput.files[0]);

      try {
        const res = await fetch('/chat', {
          method: 'POST',
          body: formData
        });
        const data = await res.json();
        showResponse(data.text, data.voice);
      } catch (err) {
        alert('Error communicating with server.');
      }
    });

    function showResponse(text, voiceUrl = null) {
      const resultDiv = document.getElementById('result');
      const responseText = document.getElementById('responseText');
      const audioPlayer = document.getElementById('audioPlayer');

      responseText.textContent = text;
      resultDiv.classList.remove('hidden');

      if (voiceUrl) {
        audioPlayer.src = voiceUrl;
        audioPlayer.classList.remove('hidden');
        audioPlayer.load();
      } else {
        audioPlayer.classList.add('hidden');
        audioPlayer.src = '';
      }
    }
  </script>
</body>
</html>
